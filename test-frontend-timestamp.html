<!DOCTYPE html>
<html>
<head>
    <title>前端时间戳测试</title>
</head>
<body>
    <h1>前端时间戳解析测试</h1>
    <div id="results"></div>

    <script>
        // 复制前端的parseTimestamp函数
        function parseTimestamp(timestamp) {
            if (!timestamp || timestamp === 'N/A' || timestamp === 'null' || timestamp === 'undefined') {
                return null;
            }
            
            try {
                // 清理时间戳字符串
                const cleanTimestamp = timestamp.toString().trim();
                
                // 检查是否为空或无效
                if (!cleanTimestamp || cleanTimestamp === 'N/A') {
                    return null;
                }
                
                // 尝试解析不同的时间格式
                if (cleanTimestamp.includes('T')) {
                    // ISO格式: 2024-12-01T10:30:21
                    return new Date(cleanTimestamp);
                } else if (cleanTimestamp.match(/^\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}$/)) {
                    // 标准格式: 2024-12-01 10:30:21
                    return new Date(cleanTimestamp);
                } else if (cleanTimestamp.match(/^\d{2}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}$/)) {
                    // 短格式: 24-12-01 10:30:21
                    const parts = cleanTimestamp.split(' ');
                    const dateParts = parts[0].split('-');
                    const year = '20' + dateParts[0];
                    const formattedDate = `${year}-${dateParts[1]}-${dateParts[2]} ${parts[1]}`;
                    return new Date(formattedDate);
                } else if (cleanTimestamp.match(/^\d+$/)) {
                    // Unix时间戳
                    const unixTimestamp = parseInt(cleanTimestamp);
                    // 检查是否为合理的时间戳（1970年后）
                    if (unixTimestamp > 0 && unixTimestamp < 9999999999) {
                        return new Date(unixTimestamp * 1000);
                    } else if (unixTimestamp > 9999999999) {
                        return new Date(unixTimestamp);
                    }
                    return null;
                } else {
                    // 尝试直接解析
                    const date = new Date(cleanTimestamp);
                    // 检查日期是否有效且不是1970年
                    if (isNaN(date.getTime()) || date.getFullYear() < 1990) {
                        return null;
                    }
                    return date;
                }
            } catch (error) {
                console.warn('无法解析时间戳:', timestamp, error);
                return null;
            }
        }

        function formatDateTime(date) {
            return date.toLocaleString('zh-CN', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
        }

        function formatTimestamp(timestamp) {
            if (!timestamp || timestamp === 'N/A') {
                return 'N/A';
            }
            
            const date = parseTimestamp(timestamp);
            if (!date) {
                return timestamp; // 如果无法解析，返回原始值
            }
            
            return formatDateTime(date);
        }

        // 测试数据
        const testTimestamps = [
            '2024-12-01 10:30:21',
            '2024-12-01 10:30:26',
            '2024-12-01 10:30:31',
            '2024-12-01 10:30:36',
            '2024-12-01 10:30:41',
            null,
            undefined,
            'N/A',
            '1733040620',  // Unix时间戳
            '24-12-01 10:30:21'  // 短格式
        ];

        const resultsDiv = document.getElementById('results');
        let html = '<table border="1"><tr><th>原始时间戳</th><th>解析结果</th><th>格式化结果</th></tr>';

        testTimestamps.forEach(timestamp => {
            const parsed = parseTimestamp(timestamp);
            const formatted = formatTimestamp(timestamp);
            
            html += `<tr>
                <td>${timestamp || 'null/undefined'}</td>
                <td>${parsed ? parsed.toString() : 'null'}</td>
                <td>${formatted}</td>
            </tr>`;
        });

        html += '</table>';
        resultsDiv.innerHTML = html;

        // 模拟后端返回的数据
        const mockOperations = [
            {
                type: "INSERT",
                database: "test_db",
                table: "users",
                timestamp: "2024-12-01 10:30:21",
                serverId: "1"
            },
            {
                type: "UPDATE",
                database: "test_db",
                table: "users",
                timestamp: "2024-12-01 10:30:26",
                serverId: "1"
            }
        ];

        console.log('模拟操作数据:');
        mockOperations.forEach((op, index) => {
            console.log(`${index + 1}. ${op.type} ${op.database}.${op.table}`);
            console.log(`   原始时间戳: ${op.timestamp}`);
            console.log(`   解析结果: ${parseTimestamp(op.timestamp)}`);
            console.log(`   格式化结果: ${formatTimestamp(op.timestamp)}`);
            console.log('');
        });
    </script>
</body>
</html>